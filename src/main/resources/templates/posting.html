<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko"
xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>porlog</title>
  
<!-- 오픈그래프 -->
<meta property="og:type" content="website" />
<meta property="og:site_name" content="porlog" />
<meta property="og:title" content="Belog KOSTA KOREA" />
<meta property="og:description" content="porlog는 2021년6월1일~7월12일에 개발한 홈페이지입니다." />
<meta property="og:image" content="images/logo-1.png" />
<meta property="og:url" content="" />
<!-- 트위터카드  -->
<meta property="twitter:card" content="summary" />
<meta property="twitter:site" content="porlog" />
<meta property="twitter:title" content="porlog는 KOSTA KOREA" />
<meta property="twitter:description" content="Belog는 2021년6월1일~7월12일에 개발한 홈페이지입니다." />
<meta property="twitter:image" content="images/logo-1.png" />
<meta property="twitter:url" content="" />
<!-- 구글 폰트 -->
<link rel="preconnect" href="https://fonts.gstatic.com" />
<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet" />
<!--구글 아이콘API  -->
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<!-- 브라우져 기본 스타일 초기화  -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css">
<!-- 브라우져 타이틀 이미지 -->
<link rel="icon" href="images/logo-1.png">
<!-- css  -->
<link rel="stylesheet" href="css/sample.css">
<link rel="stylesheet" href="css/modal.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

<!-- 에디터 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/codemirror.css">
<link rel="stylesheet" th:href="@{/css/toastui-editor.css}" />

<!-- js -->
<script defer src="js/sample.js"></script>
<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>



</head>

<body>
  <!-- HEADER -->
  <header>
    <div class="inner">
      <a href="/index" class="logo">
        <img src="images/logo-2.png" alt="Belog" class="img_title">
      </a>
      <div class="sub-menu">
        <ul class="menu">
          	<li sec:authorize="!isAuthenticated()"><a href="#" data-toggle="modal" data-target="#myModal" id="">로그인 </a></li>
			<li sec:authorize="isAuthenticated()"><span sec:authentication="principal.username" id="logouttext"></span></li> 
			<li sec:authorize="isAuthenticated()"><a th:href="@{/logout}">로그아웃</a></li>
			<li sec:authorize="!isAuthenticated()"><a href="#" data-toggle="modal" data-target="#exampleModal">회원가입</a></li>
        </ul>
        <div class="search">
          <input type="text">
          <div class="material-icons">
            search
          </div>
        </div>
      </div>
      <ul class="main-menu">
        <li class="item">
          <div class="item__name"><div class="material-icons">menu</div></div>
          <div class="item__contents">
            <div class="contents__menu">
              <ul class="inner">
                <li>
                  <h4>채용정보</h4>
                  <ul>
                    <li>지역별</li>
                    <li>직업별</li>
                  </ul>
                </li>
                <li>
                  <h4>폴로그</h4>
                  <ul>
                    <li></li>
                    <li></li>
                  </ul>
                </li>
                <li>
                  <h4>내 폴로그</h4>
                  <ul>
                    <li>폴로그 확인</li>
                    <li>폴로그 수정</li>
                    <li>폴로그 삭제</li>
                  </ul>
                </li>
              </ul>
            </div>
            <div class="contents__texture">
              <div class="inner">
                <!-- <h4>나와 어울리는 커피 찾기</h4>
                <p>스타벅스가 여러분에게 어울리는 커피를 찾아드립니다.</p>
                <h4>최상의 커피를 즐기는 법</h4>
                <p>여러가지 방법을 통해 다양한 풍미의 커피를 즐겨보세요.</p> -->
              </div>
            </div>
          </div>
        </li>
        <li class="item">
          <div class="item__nameA">
          	<a th:href="@{/jInfo}">채용정보</a>
          </div>
        </li>
        <li class="item">
          <div class="item__nameA">
          		<a th:href="@{/blogList}">폴로그</a>
          </div>
        </li>
        <li class="item">
          <div class="item__nameA">
          	<div sec:authorize="isAuthenticated()">
				<a th:href="@{/basic(userID=${user?.userID})}">내 폴로그</a>
			</div>
			<div sec:authorize="isAnonymous()">
				<a th:href="@{/basic}" >내 폴로그</a>
			</div>
          </div>
        </li>
      </ul>
    </div>
  </header>
  
  
  <!-- VISUAL   조원분들이 건드려야할 부분-->
  <section class="visual">
    
    
    
    <div class="inner3" >
		<h1 style="text-align: left; padding-top: 100px; font-size:50px;"><b>새 글 작성</b></h1>
		<br>
		<div class="postingForm">
			<div class="form-group">
				<input type="text" id="postTitle" name="postTitle" placeholder="제목을 입력하세요">
			</div>
			<div>
				<div id="editor" style="box-sizing: border-box; height: 500px;">
					<input name="postContents">
				</div>
			</div>
			<br>
				<input type="hidden" id="blogID" name="blogID" th:value="${blogID}">
				<input type="hidden" id="userID" name="userID" th:value="${user.userID}">
				<label>썸네일 이미지 등록</label>
				<input type="file" name="imgFile" id="imgFile" /><br>
			<div class="form-group">
				<button id="updateButton" type="button"><b>등 록</b></button>
			</div>
		</div>
		

        
		<br><br>

        <div id="viewer"></div>
    </div>
  </section>
 

  <!-- FOOTER -->
  <footer>
    <div class="inner">
      <div class="info">
        <span>배윤호</span>
        <span>강희원</span>
        <span>임상혁</span>
        <span>배재영</span>
        <span>정한영</span>
      </div>
      <p class="copyright">
        &copy;<span class="this-year"></span>KOSTA TEAM4
      </p>
      <img src="./images/logo-2.png" alt="" class="logo">
    </div>
  </footer>


 <script th:src="@{/js/toastui-editor-all.min.js}"></script>
 <script>
 $('#registerLogin').click(function(){
	 $('#exampleModal').modal('hide'); 
	 $('#myModal').modal('show'); 
});

$('#registersend').click(function(){
	 $('#myModal').modal('hide'); 
});

$('#IDFind').click(function(){
	 $('#myModal').modal('hide'); 
});

$('#PWFind').click(function(){
	 $('#myModal').modal('hide'); 	 
});

$('#cancel-btn').click(function(){
	 $('#myModal').modal('show'); 
});

$('#cancel-btn2').click(function(){
	 $('#myModal').modal('show'); 	 
});

$('#registerCheck').click(function(){
	var id =$("#userID").val();
	
	
	$.ajax({
		 url: 'ID_Check',
		    type: 'POST',
		    dataType: 'text', //서버로부터 내가 받는 데이터의 타입
		    contentType : 'text/plain; charset=utf-8;',//내가 서버로 보내는 데이터의 타입
		    data: id,
		    success: function(data){
		        
		    	
		     	if(data == 0){		        	 
		         console.log("아이디 없음");
		         alert("사용하실 수 있는 아이디입니다.");
		         }
		   		     	else{
		         	console.log("아이디 있음");
		         	alert("중복된 아이디가 존재합니다.");
		         	$("#userID").val('');
		         	
		         } 
		    },
		    error: function (){        
		                      
		    }
	}); 
	
});


//아이디 찾기
$('#findId').click(function(){

	 $.ajax({
		 url: 'findId',
		    type: 'POST',
		    data:$('#idcatch').serialize(),
		    success: function(data){
		   console.log(data);
		        
		        $('#exampleModalID').modal('hide'); 
		   		$('#FindIDModal').modal('show');
		   		$('#catchId').html('<h1>아이디:'+data+'입니다</h1>');
		   		
		     	
		    },
		    error: function (){        
		                      
		    }
	});  
});
//인증번호
var first="";
//아이디
var fid="";
//비밀번호찾기
$('#findPW').click(function(){
	
	$("#aa").css("display","block");
	$("#aa").css("color","blue");
	$("#aa").show();
	
	 $.ajax({
		 url: 'findpw',
		    type: 'POST',
		    data:$('#pwcatch').serialize(),		   
		    success: function(data){		    	
		        $("#exampleModalPW").modal("hide");
		    	$("#mail").modal("show");
		   		/* $("#emailnumber").val(data); */
		     	first=data.test1;
		   		fid=data.test2
		   		$("#requireID").val(fid);
		   		
		    },
		    error: function (){        
		                      
		    }
	});  
});
//이메일 인증 관련
$('#permitcheck').click(function(){
	
	$.ajax({
		url:'changepw',
		type:'POST',
		data:$('#emailcatch').serialize(),
		success: function(data){			
			if(data==first){
				
				$("#mail").modal("hide");
				$("#SettingPW").modal("show");
			}
			else{
				alert("인증번호를 잘못입력하였습니다.");
			}
			
		},
		error:function(){
			
		}
	});
});
//비밀번호재설정
$('#setpwbtn').click(function(){
	
	$.ajax({
		url:'setpwform',
		type:'POST',
		data:$('#settingpwform').serialize(),
		success: function(data){			
			
			$('#SettingPW').modal('hide');
			
		},
		error:function(){
			
		}
	});
});

$(document).ready(function(){
	 $("#logouttext").append("님 환영합니다");
});
 /* 여기까지가 모달 */
 
 
 
 //썸네일 url변경
  var thumbUrl;
 
  $("#imgFile").change(function(file){
	    var formdata = new FormData();
		formdata.append('image',file.target.files[0]);
		 
		 $.ajax({
				url:"/uploadThumbnail",
				data: formdata,
				async : false,
				type: "post",
				contentType: false,
				processData: false,
				success: function(data){
					thumbUrl = data;
				}
			});
   }); 
 
 //에디터
 const content = [].join('\n');

 const editor = new toastui.Editor({
     el: document.querySelector('#editor'),
     previewStyle: 'vertical',
     initialEditType: "wysiwyg",
     height: '700px',
     width: '1300px',
     initialValue: content,
      hooks: { 
	       addImageBlobHook: (fileOrBlob, callback) => {   //fileOrBlob:파일객체를 되돌려줌
	    	   var imgurl = uploadImgApi(fileOrBlob, callback);	   
	       },
  		}//hooks end 
 });
 
 //등록버튼
 $("#updateButton").click(function(){
	 var id = $("input[name='blogID']").val();
	 var data = {"blogID":id, "postTitle":$("#postTitle").val(), "postContents":editor.getHTML(), "postThumbnail":thumbUrl};
	 var param = $("input[id='userID']").val();
	 $.ajax({
		url:"/postUpdate",
		data: data,
		type: "post",
		success: function(res) {
			location.href="/basic?userID="+ param; 
		}
	 });  
 });
 
 
 //에디터에서 이미지 첨부
 function uploadImgApi(fileOrBlob, callback){
	 var formdata = new FormData();
	 formdata.append('image',fileOrBlob);
	 
	$.ajax({
		url:"/uploadImg",
		data: formdata,
		async : false,
		type: "post",
		contentType: false,
		processData: false,
		success: function(data){
			callback(data, fileOrBlob.name);
		}
	});
 }
 
 
 

 </script>

</body>

</html>